<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=G-CHP0LWG5GF"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CHP0LWG5GF")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2009162505910536" crossorigin=anonymous></script><title>C++ 引用 &#183; rwkey</title><meta name=description content><link type=text/css rel=stylesheet href=https://rwkey.com/css/print.css media=print><link type=text/css rel=stylesheet href=https://rwkey.com/css/poole.css><link type=text/css rel=stylesheet href=https://rwkey.com/css/syntax.css><link type=text/css rel=stylesheet href=https://rwkey.com/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://rwkey.com/><h1>rwkey</h1></a><p class=lead>北漂码农</p></div><nav><ul class=sidebar-nav><li><a href=https://rwkey.com/>Home</a></li><li><a href=https://github.com/crwkey/>Github</a></li></ul></nav><p>&copy; 2023. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>C++ 引用</h1><time datetime=2022-11-12T09:51:49+0800 class=post-date>Sat, Nov 12, 2022</time><p>引用可以简单理解为一个实体的别名，这个实体可以是变量，也可以是一个常量和字面量，另外使用它的最大好处是在内存中不会生成副本，提高了数据的传递效率。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;string&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span><span style=color:#ff79c6>using</span> <span style=color:#ff79c6>namespace</span> std;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> a <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>1</span>;
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> <span style=color:#ff79c6>&amp;</span>r1 <span style=color:#ff79c6>=</span> a; <span style=color:#6272a4>//r1 对 a 的引用
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int</span> b <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>10</span>;
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int</span><span style=color:#ff79c6>&amp;</span> r2 <span style=color:#ff79c6>=</span> b;  <span style=color:#6272a4>// r2 对常量 b 的引用
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>const</span> <span style=color:#8be9fd>int</span><span style=color:#ff79c6>&amp;</span> r3 <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>30</span>; <span style=color:#6272a4>// r3 对字面量 30 的引用
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>const</span> string<span style=color:#ff79c6>&amp;</span> r4 <span style=color:#ff79c6>=</span> <span style=color:#f1fa8c>&#34;hello&#34;</span>; <span style=color:#6272a4>// r4 对字面量 &#34;hello&#34; 的引用
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>  <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=定义>定义</h2><p><code>类型 &引用符号 = 实体</code></p><ol><li>变量引用<br>比如说有一个变量 int a = 1; 那么想要产生一个对变量 a 的引用r1, 那么可以这样写，int &r1 = a;</li><li>常量引用
常量定义和变量有些区别， 引用的类型必须带 const；比如说定义一个常量 const int b = 10; 那么引用的定义必须是这样： const int &r2 = b;</li><li>字面量引用
字面量引用也跟常量引用一样，类型也必须使用 const 来修饰，比如 const int& r3 = 30;</li></ol><p>注意</p><ul><li>引用不能当成实体，即没有引用的引用，int && r = 10，这种写法其实是右值引用</li><li>引用和指针有区别，指针不安全，可以随意改变实体，const 引用只能使用实体</li><li>引用是通过指针实现的，但是指针使用起来比较繁杂，需要 * 操作符来使用实体，但是引用就像使用实体变量一样来达到和使用指针一样的效果</li></ul><h2 id=引用的使用场景>引用的使用场景</h2><ul><li>引用出现在函数参数， 好处是函数传参效率更高，避免局部变量的压栈出栈<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#8be9fd>void</span> <span style=color:#50fa7b>foo</span>(<span style=color:#8be9fd>int</span><span style=color:#ff79c6>&amp;</span> a, <span style=color:#8be9fd>int</span><span style=color:#ff79c6>&amp;</span> b) {}
</span></span></code></pre></div></li><li>引用出现在返回值，注意此时返回的不能是一个局部变量, 编译会有一个 warning 提示，返回引用实体的空间会被回收，输出的结果可能是意想不到！<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span><span style=color:#8be9fd>int</span><span style=color:#ff79c6>&amp;</span> foo() {
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> a <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>3</span>;  
</span></span><span style=display:flex><span>  <span style=color:#ff79c6>return</span> a;  <span style=color:#6272a4>// warning: Reference to stack memory associated with local variable &#39;a&#39; returnedclang(-Wreturn-stack-address)
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>}
</span></span></code></pre></div>返回值的引用可以做为左值，可以被赋一个右值<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c++ data-lang=c++><span style=display:flex><span>  <span style=color:#ff79c6>#include</span> <span style=color:#ff79c6>&lt;iostream&gt;</span><span style=color:#ff79c6>
</span></span></span><span style=display:flex><span><span style=color:#ff79c6></span>  <span style=color:#ff79c6>using</span> <span style=color:#ff79c6>namespace</span> std;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> temp;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span><span style=color:#ff79c6>&amp;</span> foo() {
</span></span><span style=display:flex><span>    temp <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>10</span>;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> temp;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#8be9fd>int</span> <span style=color:#50fa7b>main</span>() {
</span></span><span style=display:flex><span>    foo() <span style=color:#ff79c6>=</span> <span style=color:#bd93f9>100</span>;  <span style=color:#6272a4>// foo() 返回的值作为左值
</span></span></span><span style=display:flex><span><span style=color:#6272a4></span>    cout <span style=color:#ff79c6>&lt;&lt;</span> temp <span style=color:#ff79c6>&lt;&lt;</span> endl;
</span></span><span style=display:flex><span>    <span style=color:#ff79c6>return</span> <span style=color:#bd93f9>0</span>;
</span></span><span style=display:flex><span>  }
</span></span></code></pre></div></li></ul><h2 id=总结>总结</h2><p>引用就是高效安全使用内存的一种方式，避免内存重复分配，相比指针，更加安全「加上 const 只读」和方便</p></div></main><script async src="https://www.googletagmanager.com/gtag/js?id=G-CHP0LWG5GF"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CHP0LWG5GF")</script></body></html>