<!doctype html><html xmlns=http://www.w3.org/1999/xhtml xml:lang=en-us lang=en-us><head><link href=https://gmpg.org/xfn/11 rel=profile><meta charset=utf-8><meta name=generator content="Hugo 0.110.0"><meta name=viewport content="width=device-width,initial-scale=1"><script async src="https://www.googletagmanager.com/gtag/js?id=G-CHP0LWG5GF"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CHP0LWG5GF")</script><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2009162505910536" crossorigin=anonymous></script><title>Rust 智能指针 &#183; rwkey</title><meta name=description content><link type=text/css rel=stylesheet href=https://rwkey.com/css/print.css media=print><link type=text/css rel=stylesheet href=https://rwkey.com/css/poole.css><link type=text/css rel=stylesheet href=https://rwkey.com/css/syntax.css><link type=text/css rel=stylesheet href=https://rwkey.com/css/hyde.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700"><link rel=apple-touch-icon-precomposed sizes=144x144 href=/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.png></head><body><aside class=sidebar><div class="container sidebar-sticky"><div class=sidebar-about><a href=https://rwkey.com/><h1>rwkey</h1></a><p class=lead>北漂码农</p></div><nav><ul class=sidebar-nav><li><a href=https://rwkey.com/>Home</a></li><li><a href=https://github.com/crwkey/>Github</a></li></ul></nav><p>&copy; 2023. All rights reserved.</p></div></aside><main class="content container"><div class=post><h1>Rust 智能指针</h1><time datetime=2022-02-03T23:14:29+0800 class=post-date>Thu, Feb 3, 2022</time><ol><li>什么是智能指针? &ldquo;智能&rdquo; 究竟是什么意思？</li><li>智能指针如何工作？</li><li>Box，Cell, RefCell, Rc, Arc, RwLock, Mutex, 这些智能指针的作用是什么？</li></ol><p>String, Vec 也是智能指针</p><p>Rust 中， Trait 决定了类型的行为，那么智能指针主要实现以下两个 Trait：</p><ol><li>Deref trait -> 拥有指针语义</li><li>Drop trait -> 拥有内存自动管理机制</li></ol><p>Copy 语义， Move 语义</p><p>解引用 * 是强制解引用， .，& 传参数 是自动解引用
*x -> *(x.deref)</p><p>智能指针智能在何处？</p><ol><li>可以智能解引用，提升开发体验 deref trait</li><li>可以自动化管理内存，安全无忧 drop trait</li></ol><p>遇到 . 操作符时，会触发自动解引用</p><p>标准库智能指针</p><ol><li>Box</li><li>vec 和 string</li><li>rc 和 ARC</li><li>cell 和 Refcell</li><li>RwLock 和 mutex</li></ol><p>Rust 编译时需要知道一个类型需要占用空间多大，递归和 trait对象不知道空间大小</p><p>存在栈上的数据结构都是 copy 语义</p><p>Cell 需要 copy 语义的类型, 借助unsafe 来实现的
RefCell 不需要</p><p>Cell, RefCell 都线程不安全</p><p>Rc vs Arc</p><p>共享计数， 进入作用域 +1， 离开作用域减 1</p><p>Rc::new(), Rc::clone()</p></div></main><script async src="https://www.googletagmanager.com/gtag/js?id=G-CHP0LWG5GF"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-CHP0LWG5GF")</script></body></html>